<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Personnel - Home</title>
    <link href="../output.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" rel="stylesheet">
    <script src="../components/components-personnel/sidebarfetch-personnel.js"></script>
    <!-- <link rel="stylesheet" href="../Medical Personnel/mpstyle.css"> -->
    <link rel="stylesheet" href="../Medical Personnel/reports.css"> 
</head>
<body class="min-h-screen bg-slate-50 flex font-inter">

    <!-- Overlay for mobile -->
<div id="sidebar-overlay" class="fixed inset-0 bg-black bg-opacity-10 hidden md:hidden z-40"></div>

<!-- Main Content -->
<div id="main-content" class="flex-1 md:ml-64 z-30">
    <!-- Navbar -->
    <header class="bg-white shadow-md p-2 flex justify-between items-center">
        <!-- Hamburger Menu -->
        <button id="hamburger" class="md:hidden ml-4 text-[#232931] focus:outline-none">
            <i class="fas fa-bars text-2xl"></i>
        </button>
        <h1 class="text-xl font-semibold ml-8 text-[#232931] hidden md:block">Payments</h1>
        <div class="flex items-center bg-white border text-white pl-6 pr-3 py-2 rounded-lg relative group">
            <img class="w-8 h-8 rounded-full mr-3 desktop-profile object-cover" alt="Profile Picture">
            <div class="text-left">
                <span id="profile-name" class="block font-semibold text-[#232931]">Loading...</span>
                <span class="block text-xs text-[#232931]">Medical Personnel</span>
            </div>
            <svg class="w-4 h-4 ml-6 lg:ml-14 text-[#232931]" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
                <path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd" />
            </svg>
            <div id="desktop-profile-dropdown" class="absolute bg-white border text-[#232931] mt-32 ml-12 rounded shadow-lg w-40 hidden group-hover:block">
                <a href="../Medical Personnel/personnel-profile.html" class="block px-4 py-2 hover:bg-gray-100">View Profile</a>
                <a href="../main page/home.html" class="block px-4 py-2 hover:bg-gray-100">Logout</a>
            </div>
        </div>
    </header>
    <!-- Page Content -->
    <main class="p-6">

        <!-- Report Navigation Buttons -->
        <div class="report-buttons">
            <button class="tab-btn" onclick="showSection('patient-record')">Patient Appointment Report</button>
            <button class="tab-btn" onclick="showSection('patient-treatment')">Treatment Report</button>
            <button class="tab-btn" onclick="showSection('payment-report')">Payment Report</button>
        </div>

        <!-- ✅ Patient Record Report Section -->
        <section id="patient-record" class="report-section">
            <div class="container">
                <h2>Patient Appointment Report</h2>

                <label for="patientstartDate">Start Date:</label>
                <input type="date" id="patientstartDate">
                
                <label for="patientendDate">End Date:</label>
                <input type="date" id="patientendDate">
                
                <button id="patientfilterButton">Filter</button>

                <p><strong>Total Patients:</strong> <span id="totalPatients">0</span></p>
                <table>
                    <thead>
                        <tr>
                            <th>Name</th>
                            <th>Gender</th>
                            <th>Contact Number</th>
                            <th>Created At</th>
                        </tr>
                    </thead>
                    <tbody id="patientList">
                        <tr><td colspan="4">Loading...</td></tr>
                    </tbody>
                </table>

                <button id="patientdownloadPdfBtn">Download Patient Report</button>
            </div>
        </section>             

        <!-- ✅ Patient Treatment Report Section -->
        <section id="patient-treatment" class="report-section" style="display: none;">
            <div class="container">
                <h2>Treatment Report</h2>
                
                <label for="startDate">Start Date:</label>
                <input type="date" id="startDate">

                <label for="endDate">End Date:</label>
                <input type="date" id="endDate">

                <div class="custom-dropdown">
                    <div class="dropdown-btn" id="dropdownBtn">Select Treatment</div>
                    <div class="dropdown-content" id="dropdownContent">
                        <input type="text" id="dropdownSearch" placeholder="Search Treatment...">
                        <div data-value="">All Treatments</div>
                        <div data-value="consultation">Consultation</div>
                        <div data-value="mild">Mild</div>
                        <div data-value="moderate">Moderate</div>
                        <div data-value="severe">Severe</div>
                        <div data-value="deep_scalping">Deep scalping (per quadrant)</div>
                        <div data-value="diastema_closure">Diastema closure</div>
                        <div data-value="temporary_dressing">Temporary dressing</div>
                        <div data-value="composite_filling">Composite filling (per surface)</div>
                        <div data-value="inlay_onlay_composite">Inlay | onlay (composite)</div>
                        <div data-value="simple_extraction">Simple extraction</div>
                        <div data-value="complicated_case">Complicated case</div>
                        <div data-value="acrylic_plastic">Acrylic | plastic</div>
                        <div data-value="pfm_crown">PFM crown</div>
                        <div data-value="pfm_crown_tilite">PFM crown (tilite)</div>
                        <div data-value="all_ceramic_porcelain">All ceramic porcelain</div>
                        <div data-value="zirconia_ceramic_brown">Zirconia ceramic brown</div>
                        <div data-value="metal_brackets">Metal brackets</div>
                        <div data-value="ceramic_brackets">Ceramic brackets</div>
                        <div data-value="self_ligating_metal_brackets">Self-ligating metal brackets</div>
                        <div data-value="self_ligating_ceramic_brackets">Self-ligating ceramic brackets</div>
                        <div data-value="clear_aligners">Clear aligners</div>
                        <div data-value="functional_appliance">Functional appliance</div>
                        <div data-value="hawleys_retainer">Hawley's retainer (u/l)</div>
                        <div data-value="essix_retainers">Essix retainers</div>
                        <div data-value="fixed_retainers">Fixed retainers</div>
                        <div data-value="temporary_anchorage_device">Temporary anchorage device</div>
                        <div data-value="bracket_recementation">Bracket recementation</div>
                        <div data-value="bracket_removal">Bracket removal</div>
                        <div data-value="downpayment">Downpayment</div>
                        <div data-value="odontectomy">Odontectomy</div>
                        <div data-value="apicoectomy">Apicoectomy</div>
                        <div data-value="frenectomy">Frenectomy</div>
                        <div data-value="gingivectomy">Gingivectomy (per arch)</div>
                        <div data-value="in_office_teeth_whitening">In-office teeth whitening (u/l)</div>
                        <div data-value="at_home_whitening">At-home whitening (u/l)</div>
                        <div data-value="direct_composite">Direct composite</div>
                        <div data-value="indirect_composite">Indirect composite</div>
                        <div data-value="indirect_porcelain">Indirect porcelain</div>
                        <div data-value="new_ace">New ace (u/l)</div>
                        <div data-value="new_ace_fx">New ace fx</div>
                        <div data-value="natura_tone">Natura tone (u/l)</div>
                        <div data-value="new_ace_us">New ace (us) (u/l)</div>
                        <div data-value="biotone">Biotone (u/l)</div>
                        <div data-value="bioform">Bioform (u/l)</div>
                        <div data-value="inocap">Inocap (u/l)</div>
                        <div data-value="thermosens">Thermosens (u/l)</div>
                        <div data-value="stayplate">Stayplate (2 pontics)</div>
                        <div data-value="assembled_casted_clasp">Assembled casted clasp</div>
                        <div data-value="flexible_uni">Flexible uni</div>
                        <div data-value="flexible_bil">Flexible bil</div>
                        <div data-value="goldmesh">Goldmesh (additional)</div>
                        <div data-value="lucitone">Lucitone (add in)</div>
                        <div data-value="one_piece_uni">One piece uni</div>
                        <div data-value="one_piece_bila">One piece bila</div>
                        <div data-value="flexi_combi">Flexi combi (bilateral)</div>
                        <div data-value="reline">Reline (laboratory)</div>
                        <div data-value="rebase">Rebase (laboratory)</div>
                        <div data-value="chairside_reline">Chairside reline</div>
                        <div data-value="recementation_of_crown">Recementation of crown</div>
                        <div data-value="night_guard">Night guard (per arch)</div>
                    </div>
                </div>

                <button id="treatmentfilterButton">Filter</button>

                <p><strong>Total Treatments:</strong> <span id="totalTreatments">0</span></p>
                <p><strong>Most Popular Treatment:</strong> <span id="popularTreatment">Loading...</span></p>

                <table>
                    <thead>
                        <tr>
                            <th>Patient Name</th>
                            <th>Treatment Name</th>
                            <th>Treatment Date</th>
                        </tr>
                    </thead>
                    <tbody id="treatmentList">
                        <tr><td colspan="3">No data available</td></tr>
                    </tbody>
                </table>

                <button id="downloadTreatmentPdfBtn">Download PDF</button>
            </div>
        </section>

         <!-- ✅ Payment Report Section -->
        <section id="payment-report" class="report-section">
            <div class="container">
                <h2>Payment Report</h2>

                <label for="startDate">Start Date:</label>
                <input type="date" id="paymentstartDate">

                <label for="endDate">End Date:</label>
                <input type="date" id="paymentendDate">

                <!-- ✅ Custom Dropdown for Payment Status -->
                <div class="paymentcustom-dropdown">
                    <div class="paymentdropdown-btn" id="paymentdropdownBtn">Select Status</div>
                    <div class="paymentdropdown-content" id="paymentdropdownContent">
                        <div data-value="">All Treatments</div>
                        <div data-value="consultation">Consultation</div>
                        <div data-value="mild">Mild</div>
                        <div data-value="moderate">Moderate</div>
                        <div data-value="severe">Severe</div>
                        <div data-value="deep_scalping">Deep scalping (per quadrant)</div>
                        <div data-value="diastema_closure">Diastema closure</div>
                        <div data-value="temporary_dressing">Temporary dressing</div>
                        <div data-value="composite_filling">Composite filling (per surface)</div>
                        <div data-value="inlay_onlay_composite">Inlay | onlay (composite)</div>
                        <div data-value="simple_extraction">Simple extraction</div>
                        <div data-value="complicated_case">Complicated case</div>
                        <div data-value="acrylic_plastic">Acrylic | plastic</div>
                        <div data-value="pfm_crown">PFM crown</div>
                        <div data-value="pfm_crown_tilite">PFM crown (tilite)</div>
                        <div data-value="all_ceramic_porcelain">All ceramic porcelain</div>
                        <div data-value="zirconia_ceramic_brown">Zirconia ceramic brown</div>
                        <div data-value="metal_brackets">Metal brackets</div>
                        <div data-value="ceramic_brackets">Ceramic brackets</div>
                        <div data-value="self_ligating_metal_brackets">Self-ligating metal brackets</div>
                        <div data-value="self_ligating_ceramic_brackets">Self-ligating ceramic brackets</div>
                        <div data-value="clear_aligners">Clear aligners</div>
                        <div data-value="functional_appliance">Functional appliance</div>
                        <div data-value="hawleys_retainer">Hawley's retainer (u/l)</div>
                        <div data-value="essix_retainers">Essix retainers</div>
                        <div data-value="fixed_retainers">Fixed retainers</div>
                        <div data-value="temporary_anchorage_device">Temporary anchorage device</div>
                        <div data-value="bracket_recementation">Bracket recementation</div>
                        <div data-value="bracket_removal">Bracket removal</div>
                        <div data-value="downpayment">Downpayment</div>
                        <div data-value="odontectomy">Odontectomy</div>
                        <div data-value="apicoectomy">Apicoectomy</div>
                        <div data-value="frenectomy">Frenectomy</div>
                        <div data-value="gingivectomy">Gingivectomy (per arch)</div>
                        <div data-value="in_office_teeth_whitening">In-office teeth whitening (u/l)</div>
                        <div data-value="at_home_whitening">At-home whitening (u/l)</div>
                        <div data-value="direct_composite">Direct composite</div>
                        <div data-value="indirect_composite">Indirect composite</div>
                        <div data-value="indirect_porcelain">Indirect porcelain</div>
                        <div data-value="new_ace">New ace (u/l)</div>
                        <div data-value="new_ace_fx">New ace fx</div>
                        <div data-value="natura_tone">Natura tone (u/l)</div>
                        <div data-value="new_ace_us">New ace (us) (u/l)</div>
                        <div data-value="biotone">Biotone (u/l)</div>
                        <div data-value="bioform">Bioform (u/l)</div>
                        <div data-value="inocap">Inocap (u/l)</div>
                        <div data-value="thermosens">Thermosens (u/l)</div>
                        <div data-value="stayplate">Stayplate (2 pontics)</div>
                        <div data-value="assembled_casted_clasp">Assembled casted clasp</div>
                        <div data-value="flexible_uni">Flexible uni</div>
                        <div data-value="flexible_bil">Flexible bil</div>
                        <div data-value="goldmesh">Goldmesh (additional)</div>
                        <div data-value="lucitone">Lucitone (add in)</div>
                        <div data-value="one_piece_uni">One piece uni</div>
                        <div data-value="one_piece_bila">One piece bila</div>
                        <div data-value="flexi_combi">Flexi combi (bilateral)</div>
                        <div data-value="reline">Reline (laboratory)</div>
                        <div data-value="rebase">Rebase (laboratory)</div>
                        <div data-value="chairside_reline">Chairside reline</div>
                        <div data-value="recementation_of_crown">Recementation of crown</div>
                        <div data-value="night_guard">Night guard (per arch)</div>
                    </div>
                </div>

                <!-- ✅ Custom Dropdown for Treatment -->
                <div class="paymentcustom-dropdown">
                    <div class="treatmentdropdown-btn" id="treatmentdropdownBtn">Select Treatment</div>
                    <div class="treatmentdropdown-content" id="treatmentdropdownContent">
                        <div data-value="">All Treatments</div>
                        <div data-value="cleaning">Cleaning</div>
                        <div data-value="whitening">Whitening</div>
                        <div data-value="filling">Filling</div>
                        <div data-value="extraction">Extraction</div>
                    </div>
                </div>

                <button id="paymentfilterButton">Filter</button>

                <p><strong>Total Transactions:</strong> <span id="totalPayments">0</span></p>
                <p><strong>Total Revenue:</strong> <span id="totalRevenue">₱0.00</span></p>
                <p><strong>Total Paid Amount:</strong> <span id="totalPaid">₱0.00</span></p>

                <!-- ✅ Added Loading Indicator -->
                <div id="loadingIndicator" style="display: none;">Loading...</div>

                <table>
                    <thead>
                        <tr>
                            <th>Patient Name</th>
                            <th>Email</th>
                            <th>Treatment</th>
                            <th>Amount</th>
                            <th>Status</th>
                            <th>Date</th>
                        </tr>
                    </thead>
                    <tbody id="paymentList">
                        <tr><td colspan="6">No data available</td></tr>
                    </tbody>
                </table>

                <button id="downloadPaymentPdfBtn">Download PDF</button>

                <!-- ✅ Added Pagination Controls -->
                <div id="pagination-controls"></div>
            </div>
        </section>
    </main>

    <script src="employeePatientReport.js"></script>
    <script src="employeeTreatmentReport.js"></script>
    <script src="employeePaymentReport.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.25/jspdf.plugin.autotable.min.js"></script>
    <script>
        function showSection(sectionId) {
            // Hide all sections
            document.querySelectorAll('.report-section').forEach(section => {
                section.style.display = 'none';
            });

            // Show the selected section
            document.getElementById(sectionId).style.display = 'block';
        }

        document.addEventListener('DOMContentLoaded', async () => {
            const profileResponse = await fetch('/api/medicalPersonnel/profile');
            if (profileResponse.ok) {
                const personnelData = await profileResponse.json();
                displayProfileInfo(personnelData);

                // Set the profile picture if available
                const profilePictureElement = document.querySelector('.desktop-profile');
                profilePictureElement.src = personnelData.profilePicture 
                    ? `/uploads/${personnelData.profilePicture}` 
                    : '../media/logo/default-profile.png';
            }
            });

            function displayProfileInfo(data) {
            document.getElementById('profile-name').innerText = `${data.firstName}`;
            }
                function showSection(sectionId) {
                    // Hide all sections
                    document.querySelectorAll('.report-section').forEach(section => {
                        section.style.display = 'none';
                    });

                    // Show the selected section
                    document.getElementById(sectionId).style.display = 'block';
                }

                function toggleDropdown(dropdownId) {
                    const dropdown = document.getElementById(dropdownId);
                    if (dropdown.classList.contains('hidden')) {
                        dropdown.classList.remove('hidden');
                    } else {
                        dropdown.classList.add('hidden');
                    }
                }

                // Close dropdown when clicking outside
                document.addEventListener('click', function (event) {
                    const dropdown = document.getElementById('desktop-profile-dropdown');
                    const profileDiv = document.querySelector('.group');
                    if (!profileDiv.contains(event.target)) {
                        dropdown.classList.add('hidden');
                    }
                });
    </script>

</body>
</html>