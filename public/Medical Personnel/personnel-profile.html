<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Personnel - Profile</title>
    <!-- <link rel="stylesheet" href="../Medical Personnel/mpstyle.css"> -->
    <link href="../output.css" rel="stylesheet">
    <link rel="icon" href="../media/logo/EJPL.png" type="image/x-icon">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" rel="stylesheet">
    <script src="../components/components-personnel/sidebarfetch-personnel.js"></script>
</head>

<body class="min-h-screen bg-slate-50 flex font-inter">

    <!-- Overlay for mobile -->
    <div id="sidebar-overlay" class="fixed inset-0 bg-black bg-opacity-10 hidden lg:hidden z-40"></div>

    <!-- Main Content -->
    <div id="main-content" class="flex-1 lg:ml-64 z-30">
        <!-- Navbar -->
        <header class="bg-white shadow-md p-2 flex justify-between items-center">
            <!-- Hamburger Menu -->
            <button id="hamburger" class="lg:hidden ml-4 text-[#232931] focus:outline-none">
                <i class="fas fa-bars text-2xl"></i>
            </button>
            <h1 class="text-xl font-semibold ml-8 text-[#232931] hidden lg:block">Your Profile</h1>
            <!-- Notification Bell -->
            <div class="flex items-center gap-4">
                <div class="relative">
                    <!-- Notification Bell -->
                    <button id="notification-bell" class="relative focus:outline-none">
                        <i class="fas fa-bell text-[#232931] text-xl hover:text-gray-600"></i>
                        <span id="notification-count"
                            class="absolute -top-1 -right-1 bg-red-500 text-white text-xs font-bold rounded-full px-1 hidden">0</span>
                    </button>
                    <!-- Notification Dropdown -->
                    <div id="notification-dropdown"
                        class="absolute right-0 mt-2 w-96 bg-white border border-gray-200 rounded-lg shadow-lg hidden z-50">
                        <div class="p-4 border-b border-gray-200">
                            <div class="flex gap-2">
                                <button onclick="markSelectedAsRead()"
                                    class="flex-1 py-1 bg-green-500 text-white text-xs font-semibold rounded hover:bg-green-600">Mark
                                    as Read</button>
                                <button onclick="markSelectedAsUnread()"
                                    class="flex-1 py-1 bg-blue-500 text-white text-xs font-semibold rounded hover:bg-blue-600">Mark
                                    as Unread</button>
                                <button onclick="deleteSelectedNotifications()"
                                    class="flex-1 py-1 bg-red-500 text-white text-xs font-semibold rounded hover:bg-red-600">Delete</button>
                            </div>
                        </div>
                        <ul id="notification-list" class="max-h-48 overflow-y-auto p-2 space-y-2">
                            <!-- Notifications will be dynamically added here -->
                            <li class="text-sm text-gray-500 text-center">No notifications</li>
                        </ul>
                    </div>
                </div>
                <div id="mobile-notification-dropdown"
                    class="absolute left-0 mt-[19rem] w-full bg-white border border-gray-200 rounded-none shadow-lg hidden z-50">
                    <div class="p-4 border-b border-gray-200">
                        <div class="flex gap-2">
                            <button onclick="markSelectedAsRead()"
                                class="flex-1 py-1 bg-green-500 text-white text-xs font-semibold rounded hover:bg-green-600">Mark
                                as Read</button>
                            <button onclick="markSelectedAsUnread()"
                                class="flex-1 py-1 bg-blue-500 text-white text-xs font-semibold rounded hover:bg-blue-600">Mark
                                as Unread</button>
                            <button onclick="deleteSelectedNotifications()"
                                class="flex-1 py-1 bg-red-500 text-white text-xs font-semibold rounded hover:bg-red-600">Delete</button>
                        </div>
                    </div>
                    <ul id="mobile-notification-list" class="max-h-48 overflow-y-auto p-2 space-y-2">
                        <!-- Notifications will be dynamically added here -->
                        <li class="text-sm text-gray-500 text-center">No notifications</li>
                    </ul>
                </div>
                <div id="profile-container"
                    class="flex items-center bg-white border text-white pl-6 pr-3 py-2 rounded-lg relative group">
                    <img class="w-8 h-8 rounded-full mr-0 lg:mr-3 desktop-profile object-cover" alt="Profile Picture">
                    <div class="hidden lg:block text-left">
                        <span id="profile-name" class="block font-semibold text-[#232931]">Loading...</span>
                        <span class="block text-xs text-[#232931]">Medical Personnel</span>
                    </div>
                    <svg class="w-4 h-4 ml-6 lg:ml-14 text-[#232931]" xmlns="http://www.w3.org/2000/svg"
                        viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
                        <path fill-rule="evenodd"
                            d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z"
                            clip-rule="evenodd" />
                    </svg>
                    <div id="desktop-profile-dropdown"
                        class="absolute bg-white border text-[#232931] mt-32 right-2 lg:right-auto lg:ml-12 rounded shadow-lg w-40 hidden lg:group-hover:block">
                        <a href="../Medical Personnel/personnel-profile.html"
                            class="block px-4 py-2 hover:bg-gray-100">View Profile</a>
                        <a href="../main page/home.html" class="block px-4 py-2 hover:bg-gray-100">Logout</a>
                    </div>
                </div>
                <div id="mobile-profile-dropdown"
                    class="hidden lg:hidden fixed top-[4rem] left-0 w-full bg-white border text-[#232931] rounded-none shadow-lg z-50">
                    <a href="../Medical Personnel/personnel-profile.html" class="block px-6 py-4 hover:bg-gray-100">View
                        Profile</a>
                    <a href="../main page/home.html" class="block px-6 py-4 hover:bg-gray-100">Logout</a>
                </div>
            </div>
        </header>
        <!-- Page Content -->
        <main class="p-6">
            <div class="container mx-auto px-4 lg:px-6 xl:px-8">
                <!-- Profile Picture Section -->
                <div
                    class="flex flex-col items-center mt-12 text-center sm:flex-row sm:items-start sm:text-left relative">
                    <div class="relative group mb-4 sm:mb-0">
                        <img src="../media/logo/default-profile.png?nocache=1" id="profile-picture"
                            alt="Profile Picture" class="w-32 h-32 rounded-lg object-cover">
                        <div class="absolute inset-0 bg-black bg-opacity-20 flex items-center justify-center opacity-0 group-hover:opacity-100 w-32 h-32 rounded-lg transition-opacity"
                            onclick="openPictureModal()">
                            <i class="fas fa-edit text-gray-100 text-2xl"></i>
                        </div>
                    </div>
                    <div class="sm:ml-6">
                        <h1 id="full-name" class="text-2xl text-[#232931] font-semibold"></h1>
                        <p class="text-sm text-gray-600 mb-4">Medical Personnel</p>
                    </div>
                    <button
                        class="bg-[#2C4A66] hover:bg-[#1E354D] text-white px-4 py-2 rounded-lg mt-4 sm:mt-0 sm:absolute sm:top-0 sm:right-0"
                        onclick="toggleEditForm()">Edit Profile</button>
                </div>

                <!-- Profile Information Section -->
                <div class="mt-8 w-full">
                    <div class="relative flex items-center">
                        <hr class="w-8 border-[#232931] mr-4">
                        <span class="text-[#232931] font-semibold">Profile Information</span>
                        <hr class="flex-grow border-[#232931] ml-4">
                    </div>
                </div>

                <div class="w-[90%] mx-auto mt-6">
                    <div class="mb-8">
                        <label class="text-gray-600">Birthday</label>
                        <p id="birthday-info" class="text-[#232931] font-bold"></p>
                    </div>
                    <div class="mb-8">
                        <label class="text-gray-600">Email</label>
                        <p id="email-info" class="text-[#232931] font-bold" </p>
                    </div>
                </div>

                <!-- Profile Picture Modal -->
                <div id="picture-options-modal"
                    class="fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 z-50"
                    style="display: none;">
                    <div class="bg-white rounded-lg shadow-lg p-6 w-[95%] sm:w-96 relative">
                        <button class="absolute top-2 right-3 text-gray-500 hover:text-gray-700 text-xl"
                            onclick="closePictureModal()">&times;</button>
                        <h2 class="text-lg font-semibold mb-4 text-center text-[#232931]">Edit Profile Picture</h2>
                        <img id="profile-preview" src="" alt="Preview"
                            class="w-32 h-32 rounded-full mx-auto mb-4 border border-gray-300 object-cover">
                        <label for="upload-picture" class="block text-sm font-medium text-gray-700 mb-2">Change Profile
                            Picture:</label>
                        <input type="file" id="upload-picture" name="profilePicture" accept="image/*"
                            class="block w-full text-sm text-gray-900 border border-gray-300 rounded-lg cursor-pointer focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                        <div class="flex justify-between mt-6">
                            <button class="bg-red-500 text-white px-4 py-2 rounded-lg hover:bg-red-600"
                                onclick="showDeleteConfirmation()">Remove</button>
                            <button class="bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-600"
                                onclick="showUploadConfirmation()">Upload</button>
                        </div>

                        <!-- Delete Confirmation Modal -->
                        <div id="delete-confirmation-modal"
                            class="fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 z-50"
                            style="display: none;">
                            <div class="bg-white rounded-lg shadow-lg p-6 w-80 relative">
                                <h3 class="text-lg font-semibold mb-4 text-center text-[#232931]">Confirm Delete</h3>
                                <p class="text-sm text-gray-600 mb-4 text-center">Are you sure you want to delete your
                                    profile picture?</p>
                                <div class="flex justify-between">
                                    <button class="bg-gray-500 text-white px-4 py-2 rounded-lg hover:bg-gray-600"
                                        onclick="confirmDelete(false)">No</button>
                                    <button class="bg-green-500 text-white px-4 py-2 rounded-lg hover:bg-green-600"
                                        onclick="confirmDelete(true)">Yes</button>
                                </div>
                                <button class="absolute top-2 right-3 text-gray-500 hover:text-gray-700 text-xl"
                                    onclick="closeDeleteConfirmation()">&times;</button>
                            </div>
                        </div>

                        <!-- Success Message -->
                        <div id="modal-success-message" class="text-green-500 text-center mt-4 hidden">
                            Profile picture uploaded successfully.
                        </div>

                        <!-- Error Message -->
                        <div id="modal-error-message" class="text-red-500 text-center mt-4 hidden">
                            Profile picture cancelled.
                        </div>

                        <!-- Upload Confirmation Modal -->
                        <div id="upload-confirmation-modal"
                            class="fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 z-50"
                            style="display: none;">
                            <div class="bg-white rounded-lg shadow-lg p-6 w-80 relative">
                                <h3 class="text-lg font-semibold mb-4 text-center text-[#232931]">Confirm Upload</h3>
                                <p class="text-sm text-gray-600 mb-4 text-center">Are you sure you want to upload this
                                    picture as your profile picture?</p>
                                <div class="flex justify-between">
                                    <button class="bg-green-500 text-white px-4 py-2 rounded-lg hover:bg-green-600"
                                        onclick="confirmUpload(true)">Yes</button>
                                    <button class="bg-gray-500 text-white px-4 py-2 rounded-lg hover:bg-gray-600"
                                        onclick="confirmUpload(false)">No</button>
                                </div>
                                <button class="absolute top-2 right-3 text-gray-500 hover:text-gray-700 text-xl"
                                    onclick="closeUploadConfirmation()">&times;</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Edit Form -->
                <div id="overlay" class="fixed inset-0 flex items-center justify-center bg-black bg-opacity-10 z-50"
                    style="display:none;">
                    <div class="bg-white rounded-lg shadow-lg p-6 w-[95%] sm:w-96 relative">
                        <button class="absolute top-2 right-3 text-gray-500 hover:text-gray-700 text-xl"
                            onclick="toggleEditForm()">&times;</button>
                        <h2 class="text-lg font-semibold mb-4 text-center text-[#232931]">Edit Profile</h2>
                        <form id="edit-form" class="space-y-4">
                            <div>
                                <label for="edit-personnelemail"
                                    class="block text-sm font-medium text-gray-700">Email:</label>
                                <input type="email" id="edit-personnelemail" name="email" required
                                    class="mt-1 block w-full border border-gray-300 rounded-lg shadow-sm focus:ring-blue-500 focus:border-blue-500 px-3 py-2">
                            </div>
                            <div class="relative">
                                <label for="personnelcurrent-password"
                                    class="block text-sm font-medium text-gray-700">Current Password:</label>
                                <input type="password" id="personnelcurrent-password" name="currentPassword" required
                                    class="mt-1 block w-full border border-gray-300 rounded-lg shadow-sm focus:ring-blue-500 focus:border-blue-500 px-3 py-2">
                                <i class="fas fa-eye absolute top-9 right-3 text-gray-500 cursor-pointer"
                                    onclick="togglePasswordVisibility('personnelcurrent-password', this)"></i>
                            </div>
                            <div class="relative">
                                <label for="personnelnew-password" class="block text-sm font-medium text-gray-700">New
                                    Password:</label>
                                <input type="password" id="personnelnew-password" name="newPassword"
                                    class="mt-1 block w-full border border-gray-300 rounded-lg shadow-sm focus:ring-blue-500 focus:border-blue-500 px-3 py-2">
                                <i class="fas fa-eye absolute top-9 right-3 text-gray-500 cursor-pointer"
                                    onclick="togglePasswordVisibility('personnelnew-password', this)"></i>
                            </div>
                            <div id="edit-error-message" class="text-red-500 text-sm hidden"></div>
                            <div id="edit-success-message" class="text-green-500 text-sm hidden"></div>
                            <button type="button" onclick="confirmSave()"
                                class="w-full bg-blue-500 text-white py-2 px-4 rounded-lg hover:bg-blue-600">Save</button>
                        </form>
                    </div>
                </div>

                <!-- Logout Confirmation Modal -->
                <div id="logout-overlay"
                    class="fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 z-50"
                    style="display:none;">
                    <div class="bg-white rounded-lg shadow-lg p-6 w-[95%] sm:w-96 relative">
                        <h2>Are you sure you want to log out?</h2>
                        <button class="confirm-btn" onclick="confirmLogout(true)">Yes</button>
                        <button class="cancel-btn" onclick="confirmLogout(false)">No</button>
                    </div>
                </div>
            </div>
        </main>
        <script src="../Medical Personnel/personnelnotification.js"></script>
        <script>
            function showLogoutModal() {
                const overlay = document.getElementById('logout-overlay');
                overlay.style.display = 'flex';
            }

            function confirmLogout(isConfirmed) {
                const overlay = document.getElementById('logout-overlay');
                if (isConfirmed) {
                    window.location.href = "/main page/home.html";
                } else {
                    overlay.style.display = 'none';
                }
            }

            document.addEventListener('DOMContentLoaded', async () => {
                const profileResponse = await fetch('/api/medicalPersonnel/profile');
                if (profileResponse.ok) {
                    const personnelData = await profileResponse.json();
                    displayProfileInfo(personnelData);

                    // Set the profile picture if available
                    const profilePictureElement = document.getElementById('profile-picture');
                    profilePictureElement.src = personnelData.profilePicture
                        ? `/uploads/${personnelData.profilePicture}`
                        : '../media/logo/default-profile.png';
                }
            });

            function displayProfileInfo(data) {
                const birthday = new Date(data.birthday);

                // Check if the date is valid
                if (isNaN(birthday.getTime())) {
                    console.error("Invalid birthday format");
                    return;
                }

                const options = { year: 'numeric', month: 'long', day: 'numeric' };
                const formattedBirthday = birthday.toLocaleDateString(undefined, options);

                document.getElementById('full-name').innerText = `Full Name: ${data.firstName} ${data.lastName}`;
                document.getElementById('birthday-info').innerText = `Birthday: ${formattedBirthday}`;
                document.getElementById('email-info').innerText = `Email: ${data.email}`;
            }

            function toggleEditForm() {
                const overlay = document.getElementById('overlay');
                const formContainer = document.getElementById('form-container');

                // Toggle the visibility of the overlay and the form container
                const isHidden = overlay.style.display === 'none' || overlay.style.display === '';

                overlay.style.display = isHidden ? 'flex' : 'none';
                formContainer.style.display = isHidden ? 'flex' : 'none';

                if (!isHidden) {
                    hideMessages();
                }
            }

            function hideMessages() {
                const errorMessageDiv = document.getElementById('edit-error-message');
                const successMessageDiv = document.getElementById('edit-success-message');
                errorMessageDiv.style.display = 'none';
                successMessageDiv.style.display = 'none';
            }

            function confirmSave() {
                // Show the custom confirmation modal
                document.getElementById('profileconfirmation-modal').style.display = 'flex';
            }

            function confirmChanges(isConfirmed) {
                const modal = document.getElementById('profileconfirmation-modal');
                if (isConfirmed) {
                    updateProfile(); // Call updateProfile if user confirmed
                }
                modal.style.display = 'none'; // Hide the modal regardless of the choice
            }

            async function updateProfile() {
                const email = document.getElementById('edit-personnelemail').value;
                const currentPassword = document.getElementById('personnelcurrent-password').value;
                const newPassword = document.getElementById('personnelnew-password').value;

                // Clear previous messages
                const errorMessageDiv = document.getElementById('edit-error-message');
                const successMessageDiv = document.getElementById('edit-success-message');
                errorMessageDiv.innerText = '';
                errorMessageDiv.style.display = 'none';
                successMessageDiv.innerText = '';
                successMessageDiv.style.display = 'none';

                fetch('/api/medicalPersonnel/update', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ email, currentPassword, newPassword }),
                })
                    .then(response => {
                        return response.json().then(result => {
                            if (response.ok) {
                                return { result, ok: true };
                            } else {
                                console.error('Error fetching updated profile:', response.statusText);
                                return { result, ok: false };
                            }
                        });
                    })
                    .then(({ result, ok }) => {
                        console.log('Update response:', result); // Log the entire result

                        if (ok) {
                            let successMessage = '';
                            if (result.emailUpdated) {
                                successMessage += 'Email updated successfully. ';
                            }
                            if (result.passwordUpdated) {
                                successMessage += 'Password updated successfully. ';
                            }
                            successMessageDiv.innerText = successMessage.trim();
                            successMessageDiv.style.display = 'block';

                            setTimeout(() => {
                                successMessageDiv.style.display = 'none';
                            }, 2000);

                            document.getElementById('edit-form').reset();

                            // Refresh profile
                            fetchProfileData();
                        } else {
                            errorMessageDiv.innerText = result.message || 'An error occurred during profile update.';
                            errorMessageDiv.style.display = 'block';
                        }
                    });
            }

            async function fetchProfileData() {
                fetch('/medicalPersonnel/profile')
                    .then(profileResponse => {
                        if (profileResponse.ok) {
                            return profileResponse.json();
                        } else {
                            console.error('Error fetching updated profile:', profileResponse.statusText);
                            return null;
                        }
                    })
                    .then(personnelData => {
                        if (personnelData) {
                            displayProfileInfo(personnelData);
                        } else {
                            console.error('Profile data could not be retrieved.');
                        }
                    });
            }

            // Open picture modal
            function openPictureModal() {
                const modal = document.getElementById("picture-options-modal");
                const profilePicture = document.getElementById("profile-picture").src;
                const preview = document.getElementById("profile-preview");
                preview.src = profilePicture; // Set the current picture as the preview
                modal.style.display = "flex";
            }

            // Close picture modal
            function closePictureModal() {
                const modal = document.getElementById("picture-options-modal");
                modal.style.display = "none";
            }

            // Preview the selected image before uploading
            function previewSelectedImage(event) {
                const file = event.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function (e) {
                        const preview = document.getElementById("profile-preview");
                        preview.src = e.target.result; // Set the preview image source
                    };
                    reader.readAsDataURL(file);
                }
            }

            // Show the upload confirmation modal
            function showUploadConfirmation() {
                const confirmationModal = document.getElementById("upload-confirmation-modal");
                confirmationModal.style.display = "flex";
            }

            // Close the upload confirmation modal
            function closeUploadConfirmation() {
                const confirmationModal = document.getElementById("upload-confirmation-modal");
                confirmationModal.style.display = "none";
            }

            // Display messages in modal
            function showMessageInModal(isSuccess, message) {
                const successMessage = document.getElementById("modal-success-message");
                const errorMessage = document.getElementById("modal-error-message");

                if (isSuccess) {
                    successMessage.textContent = message;
                    successMessage.style.display = "block";
                    errorMessage.style.display = "none";
                } else {
                    errorMessage.textContent = message;
                    errorMessage.style.display = "block";
                    successMessage.style.display = "none";
                }

                // Auto-hide message after 3 seconds
                setTimeout(() => {
                    successMessage.style.display = "none";
                    errorMessage.style.display = "none";
                }, 2000);
            }

            // Confirm or cancel the upload
            async function confirmUpload(isConfirmed) {
                closeUploadConfirmation();

                if (!isConfirmed) {
                    showMessageInModal(false, "Upload canceled.");
                } else {
                    const pictureInput = document.getElementById("upload-picture");

                    if (!pictureInput.files || pictureInput.files.length === 0) {
                        showMessageInModal(false, "Please select a picture to upload.");
                    } else {
                        const formData = new FormData();
                        formData.append("profilePicture", pictureInput.files[0]);

                        const response = await fetch("/api/medicalPersonnel/upload-profile-picture", {
                            method: "POST",
                            body: formData,
                        }).catch(() => null); // Handle network errors by returning null

                        if (!response) {
                            showMessageInModal(false, "An error occurred during the upload.");
                        } else if (response.ok) {
                            const result = await response.json();
                            document.getElementById("profile-picture").src = `/uploads/${result.filename}`;
                            document.getElementById("profile-preview").src = `/uploads/${result.filename}`;
                            pictureInput.value = ""; // Clear the file input field
                            showMessageInModal(true, "Profile picture uploaded successfully.");
                        } else {
                            showMessageInModal(false, "Failed to upload profile picture.");
                        }
                    }
                }
            }

            document.getElementById("upload-picture").addEventListener("change", function () {
                const file = this.files[0];
                const preview = document.getElementById("profile-preview");

                if (file) {
                    const reader = new FileReader();
                    reader.onload = function (e) {
                        preview.src = e.target.result;
                    };
                    reader.readAsDataURL(file);
                } else {
                    preview.src = ""; // Optional: reset the preview if no file is selected
                }
            });

            // Upload the new profile picture
            async function uploadProfilePicture() {
                const formData = new FormData();
                const pictureInput = document.getElementById("profile-picture-input");

                if (!pictureInput.files.length) {
                    alert("Please select a file.");
                    return;
                }

                formData.append("profilePicture", pictureInput.files[0]);

                const response = await fetch("/api/upload-profile-picture", {
                    method: "POST",
                    body: formData,
                });

                if (response.ok) {
                    const result = await response.json();
                    document.getElementById("profile-picture").src = `/uploads/${result.filename}`; // Update profile picture
                    document.getElementById("profile-preview").src = `/uploads/${result.filename}`;  // Update profile preview
                    pictureInput.value = ""; // Clear the file input field
                    showMessageInModal(true, "Profile picture uploaded successfully.");
                } else {
                    showMessageInModal(false, "Failed to upload profile picture.");
                }
            }


            // Function to delete the profile picture
            async function deleteProfilePicture() {
                try {
                    const response = await fetch('/api/medicalPersonnel/delete-profile-picture', {
                        method: 'DELETE'
                    });

                    if (response.ok) {
                        const defaultPicture = "../media/logo/default-profile.png";
                        const cacheBuster = `?t=${new Date().getTime()}`;
                        document.getElementById("profile-picture").src = defaultPicture + cacheBuster;
                        document.getElementById("profile-preview").src = defaultPicture + cacheBuster;

                        showMessageInModal(true, "Profile picture deleted successfully.");
                        location.reload(true);
                    } else {
                        console.error("Failed to delete profile picture on the server:", response.statusText);
                        showMessageInModal(false, "Failed to delete profile picture.");
                    }
                } catch (error) {
                    console.error("Error during profile picture deletion:", error);
                    showMessageInModal(false, "An error occurred while deleting the profile picture.");
                }
            }

            // Show the delete confirmation modal
            function showDeleteConfirmation() {
                const confirmationModal = document.getElementById("delete-confirmation-modal");
                confirmationModal.style.display = "flex";
            }

            // Close the delete confirmation modal
            function closeDeleteConfirmation() {
                const confirmationModal = document.getElementById("delete-confirmation-modal");
                confirmationModal.style.display = "none";
            }

            // Confirm or cancel the deletion
            async function confirmDelete(isConfirmed) {
                closeDeleteConfirmation();

                if (!isConfirmed) {
                    showMessageInModal(false, "Profile picture deletion canceled.");
                } else {
                    const response = await fetch('/api/medicalPersonnel/delete-profile-picture', {
                        method: 'DELETE'
                    });

                    if (response.ok) {
                        // Reset the profile picture to the default image
                        const defaultPicture = "../media/logo/default-profile.png";
                        document.getElementById("profile-picture").src = defaultPicture;
                        document.getElementById("profile-preview").src = defaultPicture;
                        document.getElementById("sidebar-profile-picture").src = defaultPicture;
                        document.querySelector(".desktop-profile").src = defaultPicture;
                        document.querySelector(".mobile-profile").src = defaultPicture;

                        localStorage.removeItem("profilePicture");

                        // Show success message
                        showMessageInModal(true, "Profile picture deleted successfully.");
                    } else {
                        // Show error message
                        showMessageInModal(false, "Failed to delete profile picture.");
                    }
                }
            }

            async function getProfile() {
                const response = await fetch("/api/personnel-profile");

                if (response.ok) {
                    const data = await response.json();

                    document.getElementById("firstName").innerText = data.firstName;
                    document.getElementById("lastName").innerText = data.lastName;
                    document.getElementById("email").innerText = data.email;
                    document.getElementById("birthday").innerText = data.birthday;

                    // Display profile picture if available
                    if (data.profilePicture) {
                        document.getElementById("profile-picture").src = `/uploads/${data.profilePicture}`;
                        document.getElementById("profile-preview").src = `/uploads/${data.profilePicture}`;
                    } else {
                        document.getElementById("profile-picture").src = '/default-avatar.png'; // Default if no picture
                    }
                } else {
                    alert("Failed to fetch profile data.");
                }
            }


            window.onload = async function () {
                try {
                    const response = await fetch('/api/medicalPersonnel/profile');
                    if (response.ok) {
                        const data = await response.json();
                        const profilePicture = data.profilePicture
                            ? `/uploads/${data.profilePicture}`
                            : '../media/logo/default-profile.png';

                        document.getElementById("profile-picture").src = profilePicture;
                        document.getElementById("profile-preview").src = profilePicture;
                    } else {
                        console.error('Failed to fetch user profile');
                    }
                } catch (err) {
                    console.error('Error fetching profile:', err);
                }
            };

            function togglePasswordVisibility(inputId, icon) {
                const input = document.getElementById(inputId);
                if (input.type === "password") {
                    input.type = "text";
                    icon.classList.remove("fa-eye");
                    icon.classList.add("fa-eye-slash");
                } else {
                    input.type = "password";
                    icon.classList.remove("fa-eye-slash");
                    icon.classList.add("fa-eye");
                }
            }
        </script>
        <script src="../components/components-personnel/navbarpersonnel-functionalities.js"></script>
        <script src="personnelnotification.js"></script>
</body>

</html>